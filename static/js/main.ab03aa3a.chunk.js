(this["webpackJsonpnear-marketplace"]=this["webpackJsonpnear-marketplace"]||[]).push([[0],{288:function(e,t){},290:function(e,t){},315:function(e,t){},364:function(e,t){},366:function(e,t){},367:function(e,t){},373:function(e,t){},375:function(e,t){},395:function(e,t){},411:function(e,t){},414:function(e,t){},442:function(e,t){},443:function(e,t,n){},448:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),r=n(32),o=n.n(r),s=n(457),l=n(462);const i=Object({NODE_ENV:"production",PUBLIC_URL:"/auctioneer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).CONTRACT_NAME||"mycontract.ozo_vehe.testnet";var d=function(e){switch(e){case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:i,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org"};case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:i,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"};default:throw Error("Unknown environment '".concat(e,"'."))}},j=n(38),b=n(71);const u=d("testnet"),h={networkId:"testnet",keyStore:new j.keyStores.BrowserLocalStorageKeyStore,nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://testnet.mynearwallet.com/",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://testnet.nearblocks.io"};function m(){return window.walletConnection.requestSignIn({contractId:u.contractName})}function x(){window.walletConnection.signOut(),window.location.reload()}var O=n(459),p=n(454),w=n(464),g=n(1);var f=e=>{let{address:t,amount:n,symbol:c,destroy:a}=e;return t?Object(g.jsx)(g.Fragment,{children:Object(g.jsxs)(O.a,{children:[Object(g.jsx)(O.a.Toggle,{variant:"light",align:"end",id:"dropdown-basic",className:"d-flex align-items-center border rounded-pill py-1",children:n?Object(g.jsxs)(g.Fragment,{children:[n," ",Object(g.jsxs)("span",{className:"ms-1",children:[" ",c]})]}):Object(g.jsx)(p.a,{animation:"border",size:"sm",className:"opacity-25"})}),Object(g.jsxs)(O.a.Menu,{className:"shadow-lg border-0",children:[Object(g.jsx)(O.a.Item,{href:"https://explorer.testnet.near.org/accounts/".concat(t),target:"_blank",children:Object(g.jsxs)(w.a,{direction:"horizontal",gap:2,children:[Object(g.jsx)("i",{className:"bi bi-person-circle fs-4"}),Object(g.jsx)("span",{className:"font-monospace",children:t})]})}),Object(g.jsx)(O.a.Divider,{}),Object(g.jsxs)(O.a.Item,{as:"button",className:"d-flex align-items-center",onClick:()=>{a()},children:[Object(g.jsx)("i",{className:"bi bi-box-arrow-right me-2 fs-4"}),"Disconnect"]})]})]})}):null},y=n(219),N=n(458),v=n(460),C=n(221);var S=e=>{let{save:t}=e;const[n,a]=Object(c.useState)(""),[r,o]=Object(c.useState)(""),[s,l]=Object(c.useState)(""),[i,d]=Object(c.useState)(""),[j,b]=Object(c.useState)(0),[u,h]=Object(c.useState)(!1),m=()=>h(!1);return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(y.a,{onClick:()=>h(!0),variant:"dark",className:"rounded-pill px-0",style:{width:"38px"},children:Object(g.jsx)("i",{class:"bi bi-plus"})}),Object(g.jsxs)(N.a,{show:u,onHide:m,centered:!0,children:[Object(g.jsx)(N.a.Header,{closeButton:!0,children:Object(g.jsx)(N.a.Title,{children:"New Product"})}),Object(g.jsx)(v.a,{children:Object(g.jsxs)(N.a.Body,{children:[Object(g.jsx)(C.a,{controlId:"inputName",label:"Product name",className:"mb-3",children:Object(g.jsx)(v.a.Control,{type:"text",onChange:e=>{a(e.target.value)},placeholder:"Enter name of product"})}),Object(g.jsx)(C.a,{controlId:"inputUrl",label:"Image URL",className:"mb-3",children:Object(g.jsx)(v.a.Control,{type:"text",placeholder:"Image URL",onChange:e=>{o(e.target.value)}})}),Object(g.jsx)(C.a,{controlId:"inputDescription",label:"Description",className:"mb-3",children:Object(g.jsx)(v.a.Control,{as:"textarea",placeholder:"description",style:{height:"80px"},onChange:e=>{l(e.target.value)}})}),Object(g.jsx)(C.a,{controlId:"inputDuration",label:"Duration (in minutes)",className:"mb-3",children:Object(g.jsx)(v.a.Control,{type:"text",placeholder:"Duration",onChange:e=>{d(e.target.value)}})}),Object(g.jsx)(C.a,{controlId:"inputPrice",label:"Price",className:"mb-3",children:Object(g.jsx)(v.a.Control,{type:"text",placeholder:"Price",onChange:e=>{b(e.target.value)}})})]})}),Object(g.jsxs)(N.a.Footer,{children:[Object(g.jsx)(y.a,{variant:"outline-secondary",onClick:m,children:"Close"}),Object(g.jsx)(y.a,{variant:"dark",disabled:!(n&&r&&s&&i&&j),onClick:()=>{t({name:n,image:r,description:s,duration:i,price:j,created:Date.now().toString()}),m()},children:"Save product"})]})]})]})},k=n(220),I=n(461),B=n(455);var P=e=>{let{bid:t,product:n}=e;const[a,r]=Object(c.useState)(0),o=j.utils.format.formatNearAmount(n.price),s=n.bid&&j.utils.format.formatNearAmount(n.bid),l=()=>a>s&&a>o,[i,d]=Object(c.useState)(!1),b=()=>d(!1);return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(y.a,{variant:"outline-dark",onClick:()=>d(!0),className:"w-100 py-3",children:"Place Bid"}),Object(g.jsxs)(N.a,{show:i,onHide:b,centered:!0,children:[Object(g.jsx)(N.a.Header,{closeButton:!0,children:Object(g.jsx)(N.a.Title,{children:"Bid Modal"})}),Object(g.jsxs)(v.a,{children:[Object(g.jsx)(N.a.Header,{children:Object(g.jsx)("p",{className:"p-0 m-0",children:"Highest Bid: ".concat(n.bid?s:o," NEAR")})}),Object(g.jsx)(N.a.Body,{children:Object(g.jsx)(C.a,{controlId:"inputBid",label:"Bid",className:"mb-3",children:Object(g.jsx)(v.a.Control,{type:"text",placeholder:"Bid",onChange:e=>{r(e.target.value)}})})})]}),Object(g.jsxs)(N.a.Footer,{children:[Object(g.jsx)(y.a,{variant:"outline-secondary",onClick:b,children:"Close"}),Object(g.jsx)(y.a,{variant:"dark",disabled:!l(),onClick:()=>{console.log(l()),l()?t(n.id,a):alert("Bid should be higher then the current bid amount")},children:"Bid"})]})]})]})};var F=e=>{let{product:t,bid:n,withdraw:c}=e;const{id:a,name:r,description:o,sold:s,image:l,owner:i}=t;console.log(t);const d=Number(t.created)+6e4*Number(t.duration),b=Math.round((d-Date.now())/1e3/60),u=b<0,h=t.owner===window.accountId,m=()=>{c(a)};return Object(g.jsx)(k.a,{children:Object(g.jsxs)(I.a,{className:" h-100",children:[Object(g.jsx)(I.a.Header,{children:Object(g.jsxs)(w.a,{className:"d-flex flex-wrap",direction:"horizontal",gap:2,children:[Object(g.jsxs)("span",{className:"font-monospace text-secondary",children:["Owner: ",i]}),Object(g.jsx)(B.a,{bg:"secondary",className:"ms-auto",children:s&&Object(g.jsx)(g.Fragment,{children:"Sold"})}),!s&&Object(g.jsxs)("div",{className:"w-100 d-flex flex-wrap justify-content-between",children:[Object(g.jsxs)("span",{className:"font-monospace text-secondary",children:["Highest bid: ",t.bid?"".concat(j.utils.format.formatNearAmount(t.bid)," NEAR"):0]}),Object(g.jsx)("span",{className:"font-monospace text-secondary",children:u?"Bid ended":"Time left: ".concat(b," minutues")})]})]})}),Object(g.jsx)("div",{className:" ratio ratio-4x3",children:Object(g.jsx)("img",{src:l,alt:r,style:{objectFit:"cover"}})}),Object(g.jsxs)(I.a.Body,{className:"d-flex  flex-column text-center",children:[Object(g.jsx)(I.a.Title,{children:r}),Object(g.jsx)(I.a.Text,{className:"flex-grow-1 ",children:o}),(()=>{if(h){if(s||u)return Object(g.jsx)(y.a,{variant:"outline-dark",onClick:m,className:"w-100 py-3",children:"Withdraw bid"})}else if(!h&&!u)return Object(g.jsx)(P,{bid:n,product:t})})()]})]})},a)};var U=()=>Object(g.jsx)("div",{className:"d-flex justify-content-center",children:Object(g.jsx)(p.a,{animation:"border",role:"status",className:"opacity-25",children:Object(g.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}),E=n(456),T=(n(442),n(463));const A=1e14;var D=()=>{const[e,t]=Object(c.useState)([]),[n,a]=Object(c.useState)(!1),r=Object(c.useCallback)((async()=>{try{a(!0),t(await window.contract.getProducts())}catch(e){console.log({error:e})}finally{a(!1)}}),[]),o=async(e,t)=>{console.log("Placing bid...");try{await async function(e){let{id:t,price:n}=e;console.log("Placing bid on marketplace.js...");const c=Object(b.parseNearAmount)(n+"");await window.contract.placeBid({productId:t},A,c)}({id:e,price:t}).then((e=>r())),console.log("Bid placed successfully")}catch(n){}finally{a(!1)}},s=async e=>{try{await async function(e){let{id:t}=e;await window.contract.withdrawBid({id:t},A),console.log("Withdraw bid...")}({id:e}).then((e=>r()))}catch(t){}finally{a(!1)}};return Object(c.useEffect)((()=>{r()}),[]),Object(g.jsx)(g.Fragment,{children:n?Object(g.jsx)(U,{}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Object(g.jsx)("h1",{className:"fs-4 fw-bold mb-0",children:"Street Food"}),Object(g.jsx)(S,{save:async e=>{console.log(e);try{a(!0),(t=e,t.id=Object(T.a)(),t.price=Object(b.parseNearAmount)(t.price+""),window.contract.setProduct({product:t})).then((e=>{r()}))}catch(n){console.log({error:n})}finally{a(!1)}var t}})]}),Object(g.jsx)(E.a,{xs:1,sm:2,lg:3,className:"g-3  mb-5 g-xl-4 g-xxl-5",children:e.map((e=>Object(g.jsx)(F,{product:{...e},bid:o,withdraw:s})))})]})})};const H=e=>{let{name:t,login:n,coverImg:c}=e;return c?Object(g.jsxs)("div",{className:"d-flex justify-content-center flex-column text-center ",style:{background:"#000",minHeight:"100vh"},children:[Object(g.jsxs)("div",{className:"mt-auto text-light mb-5",children:[Object(g.jsx)("div",{className:" ratio ratio-1x1 mx-auto mb-2",style:{maxWidth:"320px"},children:Object(g.jsx)("img",{src:c,alt:""})}),Object(g.jsx)("h1",{children:t}),Object(g.jsx)("p",{children:"Please connect your wallet to continue."}),Object(g.jsx)(y.a,{onClick:n,variant:"outline-light",className:"rounded-pill px-3 mt-3",children:"Connect Wallet"})]}),Object(g.jsx)("p",{className:"mt-auto text-secondary",children:"Powered by NEAR"})]}):null};H.defaultProps={name:""};var _=H,R=n.p+"static/media/sandwich.2d312449.jpg";n(443);var L=function(){const e=Object(c.useRef)(window.walletConnection.account());console.log(e.current),console.log(e.current.accountId);const[t,n]=Object(c.useState)("0"),a=Object(c.useCallback)((async()=>{e.current.accountId&&n(await async function(){return Object(b.formatNearAmount)((await window.walletConnection.account().getAccountBalance()).total,2)}())}),[]),r=Object(c.useCallback)((async()=>{e.current.accountId&&(e.current=window.walletConnection.account())}),[]);return Object(c.useEffect)((()=>{a();(async()=>{r()})()}),[a,r]),Object(g.jsx)(g.Fragment,{children:e.current.accountId?Object(g.jsxs)(s.a,{fluid:"md",children:[Object(g.jsx)(l.a,{className:"justify-content-end pt-3 pb-5",children:Object(g.jsx)(l.a.Item,{children:Object(g.jsx)(f,{address:e.current.accountId,amount:t,symbol:"NEAR",destroy:x})})}),Object(g.jsx)("main",{children:Object(g.jsx)(D,{})})]}):Object(g.jsx)(_,{name:"Street Food",login:m,coverImg:R})})};var W=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,465)).then((t=>{let{getCLS:n,getFID:c,getFCP:a,getLCP:r,getTTFB:o}=t;n(e),c(e),a(e),r(e),o(e)}))};n(449),n(446),n(447);window.nearInitPromise=async function(){const e=await Object(j.connect)(h);window.walletConnection=new j.WalletConnection(e,"mycontract.ozo_vehe.testnet"),window.accountId=window.walletConnection.getAccountId(),window.contract=new j.Contract(window.walletConnection.account(),u.contractName,{viewMethods:["getProduct","getProducts","getHighestBid","getHighestBidder"],changeMethods:["placeBid","setProduct","withdrawBid"]})}().then((()=>{o.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(L,{})}),document.getElementById("root"))})).catch(console.error),W()}},[[448,1,2]]]);
//# sourceMappingURL=main.ab03aa3a.chunk.js.map