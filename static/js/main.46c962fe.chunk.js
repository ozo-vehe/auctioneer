(this["webpackJsonpnear-marketplace"]=this["webpackJsonpnear-marketplace"]||[]).push([[0],{288:function(e,t){},290:function(e,t){},315:function(e,t){},364:function(e,t){},366:function(e,t){},367:function(e,t){},373:function(e,t){},375:function(e,t){},395:function(e,t){},411:function(e,t){},414:function(e,t){},442:function(e,t,c){},447:function(e,t,c){"use strict";c.r(t);var n=c(0),a=c.n(n),s=c(33),r=c.n(s),i=c(456),l=c(461);const o=Object({NODE_ENV:"production",PUBLIC_URL:"/auctioneer",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).CONTRACT_NAME||"mycontract.ozo_vehe.testnet";var d=c(23),j=c(71);const b=function(e){switch(e){case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:o,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org"};case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://testnet.mynearwallet.com/",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://testnet.nearblocks.io"};default:throw Error("Unknown environment '".concat(e,"'."))}}("testnet");async function x(){console.log("Login in near"),window.walletConnection.requestSignIn({contractId:b.contractName,successUrl:window.location.origin}),window.walletConnection.isSignedIn()?console.log("Logged in"):console.log("Not logged in")}function h(){window.walletConnection.signOut(),window.location.reload()}var u=c(458),O=c(453),m=c(463),p=c(1);var g=e=>{let{address:t,amount:c,symbol:n,destroy:a}=e;return t?Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)(u.a,{children:[Object(p.jsx)(u.a.Toggle,{variant:"light",align:"end",id:"dropdown-basic",className:"d-flex align-items-center border rounded-pill py-1",children:c?Object(p.jsxs)(p.Fragment,{children:[c," ",Object(p.jsxs)("span",{className:"ms-1",children:[" ",n]})]}):Object(p.jsx)(O.a,{animation:"border",size:"sm",className:"opacity-25"})}),Object(p.jsxs)(u.a.Menu,{className:"shadow-lg border-0",children:[Object(p.jsx)(u.a.Item,{href:"https://explorer.testnet.near.org/accounts/".concat(t),target:"_blank",children:Object(p.jsxs)(m.a,{direction:"horizontal",gap:2,children:[Object(p.jsx)("i",{className:"bi bi-person-circle fs-4"}),Object(p.jsx)("span",{className:"font-monospace",children:t})]})}),Object(p.jsx)(u.a.Divider,{}),Object(p.jsxs)(u.a.Item,{as:"button",className:"d-flex align-items-center",onClick:()=>{a()},children:[Object(p.jsx)("i",{className:"bi bi-box-arrow-right me-2 fs-4"}),"Disconnect"]})]})]})}):null},w=c(219),f=c(457),y=c(459),N=c(221);var v=e=>{let{save:t}=e;const[c,a]=Object(n.useState)(""),[s,r]=Object(n.useState)(""),[i,l]=Object(n.useState)(""),[o,d]=Object(n.useState)(""),[j,b]=Object(n.useState)(0),[x,h]=Object(n.useState)(!1),u=()=>h(!1);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(w.a,{onClick:()=>h(!0),variant:"dark",className:"rounded-pill px-0",style:{width:"38px"},children:Object(p.jsx)("i",{class:"bi bi-plus"})}),Object(p.jsxs)(f.a,{show:x,onHide:u,centered:!0,children:[Object(p.jsx)(f.a.Header,{closeButton:!0,children:Object(p.jsx)(f.a.Title,{children:"New Product"})}),Object(p.jsx)(y.a,{children:Object(p.jsxs)(f.a.Body,{children:[Object(p.jsx)(N.a,{controlId:"inputName",label:"Product name",className:"mb-3",children:Object(p.jsx)(y.a.Control,{type:"text",onChange:e=>{a(e.target.value)},placeholder:"Enter name of product"})}),Object(p.jsx)(N.a,{controlId:"inputUrl",label:"Image URL",className:"mb-3",children:Object(p.jsx)(y.a.Control,{type:"text",placeholder:"Image URL",onChange:e=>{r(e.target.value)}})}),Object(p.jsx)(N.a,{controlId:"inputDescription",label:"Description",className:"mb-3",children:Object(p.jsx)(y.a.Control,{as:"textarea",placeholder:"description",style:{height:"80px"},onChange:e=>{l(e.target.value)}})}),Object(p.jsx)(N.a,{controlId:"inputDuration",label:"Duration (in minutes)",className:"mb-3",children:Object(p.jsx)(y.a.Control,{type:"text",placeholder:"Duration",onChange:e=>{d(e.target.value)}})}),Object(p.jsx)(N.a,{controlId:"inputPrice",label:"Price",className:"mb-3",children:Object(p.jsx)(y.a.Control,{type:"text",placeholder:"Price",onChange:e=>{b(e.target.value)}})})]})}),Object(p.jsxs)(f.a.Footer,{children:[Object(p.jsx)(w.a,{variant:"outline-secondary",onClick:u,children:"Close"}),Object(p.jsx)(w.a,{variant:"dark",disabled:!(c&&s&&i&&o&&j),onClick:()=>{t({name:c,image:s,description:i,duration:o,price:j,created:Date.now().toString()}),u()},children:"Save product"})]})]})]})},C=c(220),k=c(460),S=c(454);var I=e=>{let{bid:t,product:c}=e;const[a,s]=Object(n.useState)(0),r=d.utils.format.formatNearAmount(c.price),i=c.bid&&d.utils.format.formatNearAmount(c.bid),l=()=>a>i&&a>r,[o,j]=Object(n.useState)(!1),b=()=>j(!1);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(w.a,{variant:"outline-dark",onClick:()=>j(!0),className:"w-100 py-3",children:"Place Bid"}),Object(p.jsxs)(f.a,{show:o,onHide:b,centered:!0,children:[Object(p.jsx)(f.a.Header,{closeButton:!0,children:Object(p.jsx)(f.a.Title,{children:"Bid Modal"})}),Object(p.jsxs)(y.a,{children:[Object(p.jsx)(f.a.Header,{children:Object(p.jsx)("p",{className:"p-0 m-0",children:"Highest Bid: ".concat(c.bid?i:r," NEAR")})}),Object(p.jsx)(f.a.Body,{children:Object(p.jsx)(N.a,{controlId:"inputBid",label:"Bid",className:"mb-3",children:Object(p.jsx)(y.a.Control,{type:"text",placeholder:"Bid",onChange:e=>{s(e.target.value)}})})})]}),Object(p.jsxs)(f.a.Footer,{children:[Object(p.jsx)(w.a,{variant:"outline-secondary",onClick:b,children:"Close"}),Object(p.jsx)(w.a,{variant:"dark",disabled:!l(),onClick:()=>{console.log(l()),l()?t(c.id,a):alert("Bid should be higher then the current bid amount")},children:"Bid"})]})]})]})};var B=e=>{let{product:t,productDetails:c}=e;const[a,s]=Object(n.useState)(!1),{id:r,name:i,description:l,sold:o,image:j,owner:b,price:x,bidders:h,bids:u,created:O}=t;console.log(t);const m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=Number(t.created)+6e4*Number(t.duration),y=new Date(Number(f)),N=new Date(Number(O)),v=e=>"".concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds()),C=e=>"".concat(m[e.getDay()]," ").concat(e.getDate()," ").concat(g[e.getMonth()],", ").concat(e.getFullYear());return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(w.a,{variant:"outline-dark",onClick:()=>s(!a),className:"w-100 py-3",children:"See more"}),Object(p.jsxs)("div",{style:{position:"fixed",zIndex:10,top:"0px",left:"0px",width:"100%",minHeight:"100vh",paddingTop:"20px",margin:"0px"},className:"d-flex justify-content-start flex-column align-items-center bg-light ".concat(a?"d-flex":"d-none"),children:[Object(p.jsx)("p",{onClick:()=>s(!a),style:{cursor:"pointer",fontSize:"16px",borderWidth:1,borderColor:"black",borderStyle:"solid",padding:"5px 25px",borderRadius:"5px",backgroundColor:"white"},children:"Back"}),Object(p.jsxs)("div",{children:[Object(p.jsx)("div",{className:"",children:Object(p.jsx)("img",{src:j,width:400,height:300,alt:i,style:{objectFit:"cover"}})}),Object(p.jsx)("div",{className:"mt-4",style:{width:"400px",textAlign:"left"},children:Object(p.jsx)("table",{children:Object(p.jsxs)("tbody",{children:[Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Product ID:"}),Object(p.jsx)("td",{children:r})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Owner:"}),Object(p.jsx)("td",{children:b})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Name:"}),Object(p.jsx)("td",{children:i})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Description:"}),Object(p.jsx)("td",{children:l})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Created:"}),Object(p.jsxs)("td",{children:[C(N)," ",v(N)]})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Ends:"}),Object(p.jsxs)("td",{children:[C(y)," ",v(y)]})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Duration:"}),Object(p.jsxs)("td",{children:[t.duration," minutes"]})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Price:"}),Object(p.jsxs)("td",{children:[d.utils.format.formatNearAmount(x)," NEAR"]})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Sold:"}),Object(p.jsx)("td",{children:o.toString().toUpperCase()})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Bidders:"}),Object(p.jsx)("td",{children:Object(p.jsxs)("table",{className:"border w-100",children:[Object(p.jsxs)("thead",{children:[Object(p.jsx)("th",{children:"Bidder"}),Object(p.jsx)("th",{children:"Bid"})]}),Object(p.jsx)("tbody",{className:"border",children:h.length>0?Object(p.jsx)(p.Fragment,{children:(()=>{let e=[];for(let t=0;t<h.length;t++){let c={};c.bidder=h[t],c.bid=u[t],e.push(c)}return e})().map(((e,t)=>Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:e.bidder}),Object(p.jsxs)("td",{children:[d.utils.format.formatNearAmount(e.bid)," ","NEAR"]})]},t)))}):Object(p.jsx)("p",{className:"m-0",children:"No bidders"})})]})})]})]})})})]},r)]})]})};var F=e=>{let{product:t,bid:c,withdraw:n}=e;const{id:a,name:s,description:r,sold:i,image:l,owner:o,created:j,duration:b}=t;console.log(t);const x=Number(j)+6e4*Number(b),h=Math.round((x-Date.now())/1e3/60),u=h<0,O=o===window.walletConnection.getAccountId();console.log(window.accountId);const g=()=>{t.bid<=0?alert("No bid to withdraw"):n(a)};return Object(p.jsx)(C.a,{children:Object(p.jsxs)(k.a,{className:" h-100",children:[Object(p.jsx)(k.a.Header,{children:Object(p.jsxs)(m.a,{className:"d-flex flex-wrap",direction:"horizontal",gap:2,children:[Object(p.jsxs)("span",{className:"font-monospace text-secondary",children:["Owner: ",o]}),Object(p.jsx)(S.a,{bg:"secondary",className:"ms-auto",children:i&&Object(p.jsx)(p.Fragment,{children:"Sold"})}),!i&&Object(p.jsxs)("div",{className:"w-100 d-flex flex-wrap justify-content-between",children:[Object(p.jsxs)("span",{className:"font-monospace text-secondary",children:["Highest bid:"," ",t.bid?"".concat(d.utils.format.formatNearAmount(t.bid)," NEAR"):0]}),Object(p.jsx)("span",{className:"font-monospace text-secondary",children:u?"Bid ended":"Time left: ".concat(h," minutues")})]})]})}),Object(p.jsx)("div",{className:" ratio ratio-4x3",children:Object(p.jsx)("img",{src:l,alt:s,style:{objectFit:"cover"}})}),Object(p.jsxs)(k.a.Body,{className:"d-flex  flex-column text-center",children:[Object(p.jsx)(k.a.Title,{children:s}),Object(p.jsx)(k.a.Text,{className:"flex-grow-1 ",children:r}),Object(p.jsxs)("div",{className:"d-flex gap-4 align-items-center justify-content-center",children:[(()=>{if(O){if(u&&!i)return Object(p.jsx)(w.a,{variant:"outline-dark",onClick:g,className:"w-100 py-3",children:"Withdraw bid"})}else if(!O&&(console.log(O),!u))return Object(p.jsx)(I,{bid:c,product:t})})(),Object(p.jsx)(B,{product:t})]})]})]})},a)};var P=()=>Object(p.jsx)("div",{className:"d-flex justify-content-center",children:Object(p.jsx)(O.a,{animation:"border",role:"status",className:"opacity-25",children:Object(p.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}),A=c(455);const D=e=>{let{text:t}=e;return Object(p.jsxs)("div",{style:{position:"fixed",top:"0px",backgroundColor:"white",border:"thin solid black",width:"300px",paddingBlock:"10px",textTransform:"capitalize"},children:[Object(p.jsx)("i",{className:"bi bi-check-circle-fill mx-2"}),Object(p.jsx)("span",{className:"text-secondary mx-1",children:t})]})},T=e=>{let{text:t}=e;return Object(p.jsxs)("div",{style:{position:"fixed",top:"0px",backgroundColor:"white",border:"thin solid black",width:"300px",paddingBlock:"10px",textTransform:"capitalize"},children:[Object(p.jsx)("i",{className:"bi bi-check-circle-fill text-success mx-2"}),Object(p.jsx)("span",{className:"text-secondary mx-1",children:t})]})},E=e=>{let{text:t}=e;return Object(p.jsxs)("div",{style:{position:"fixed",top:"0px",backgroundColor:"white",border:"thin solid black",width:"300px",paddingBlock:"10px",textTransform:"capitalize"},children:[Object(p.jsx)("i",{className:"bi bi-x-circle-fill text-danger mx-2"}),Object(p.jsx)("span",{className:"text-secondary mx-1",children:t})]})};var H=c(462);const U=1e14;function R(e){return e.id=Object(H.a)(),e.price=Object(j.parseNearAmount)(e.price+""),window.contract.setProduct({product:e})}function _(){return window.contract.getProducts()}async function M(e){let{id:t}=e;await window.contract.withdrawBid({id:t},U),console.log("Withdraw bid...")}var W=()=>{const[e,t]=Object(n.useState)([]),[c,a]=Object(n.useState)(!1),[s,r]=Object(n.useState)(!1),[i,l]=Object(n.useState)(!1),[o,d]=Object(n.useState)(!1),b=Object(n.useCallback)((async()=>{try{a(!0),t(await _())}catch(o){console.log({error:o})}finally{a(!1)}}),[]),x=async(e,t)=>{console.log("Placing bid...");try{r(!0),await async function(e){let{id:t,price:c}=e;console.log("Placing bid on marketplace.js...");const n=Object(j.parseNearAmount)(c+"");await window.contract.placeBid({productId:t},U,n)}({id:e,price:t}).then((e=>b())),console.log("Bid placed successfully")}catch(o){d(!0)}finally{a(!1),r(!1)}},h=async e=>{try{await M({id:e}).then((e=>b()))}catch(o){}finally{a(!1)}};return Object(n.useEffect)((()=>{b()}),[]),Object(p.jsx)(p.Fragment,{children:c?Object(p.jsx)(P,{}):Object(p.jsxs)(p.Fragment,{children:[s&&Object(p.jsx)(D,{text:"uploading product"}),i&&Object(p.jsx)(T,{text:"Bid placed successfully"}),o&&Object(p.jsx)(E,{text:"Failed to purchase product."}),Object(p.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Object(p.jsx)("h1",{className:"fs-4 fw-bold mb-0",children:"Street Food"}),Object(p.jsx)(v,{save:async e=>{console.log(e);try{a(!0),R(e).then((e=>{b()}))}catch(o){console.log({error:o})}finally{a(!1)}}})]}),Object(p.jsx)(A.a,{xs:1,sm:2,lg:3,className:"g-3 mb-5 g-xl-4 g-xxl-5",children:e.map((e=>Object(p.jsx)(F,{product:{...e},bid:x,withdraw:h},e.id)))})]})})};const z=e=>{let{name:t,login:c,coverImg:n}=e;return n?Object(p.jsxs)("div",{className:"d-flex justify-content-center flex-column text-center ",style:{background:"#000",minHeight:"100vh"},children:[Object(p.jsxs)("div",{className:"mt-auto text-light mb-5",children:[Object(p.jsx)("div",{className:" ratio ratio-1x1 mx-auto mb-2",style:{maxWidth:"320px"},children:Object(p.jsx)("img",{src:n,alt:""})}),Object(p.jsx)("h1",{children:t}),Object(p.jsx)("p",{children:"Please connect your wallet to continue."}),Object(p.jsx)(w.a,{onClick:()=>{c(),console.log("Wallet before"),console.log(window.walletConnection.account().accountId),console.log("Wallet after")},variant:"outline-light",className:"rounded-pill px-3 mt-3",children:"Connect Wallet"})]}),Object(p.jsx)("p",{className:"mt-auto text-secondary",children:"Powered by NEAR"})]}):null};z.defaultProps={name:""};var L=z,J=c.p+"static/media/sandwich.2d312449.jpg";c(442);var K=e=>{let{user:t}=e;const[c,a]=Object(n.useState)([]),[s,r]=Object(n.useState)(!1),i=Object(n.useCallback)((async()=>{try{r(!0);const e=await _(),c=[];e.forEach((e=>{e.owner===t&&c.push(e)})),a(c)}catch(e){console.log({error:e})}finally{r(!1)}}),[]),l=async e=>{try{await M({id:e}).then((e=>i()))}catch(t){}finally{r(!1)}};return Object(n.useEffect)((()=>{i()}),[]),Object(p.jsx)(p.Fragment,{children:s?Object(p.jsx)(P,{}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Object(p.jsx)("h1",{className:"fs-4 fw-bold mb-0",children:t}),Object(p.jsx)(v,{save:async e=>{console.log(e);try{r(!0),R(e).then((e=>{i()}))}catch(t){console.log({error:t})}finally{r(!1)}}})]}),c.length>0?Object(p.jsx)(A.a,{xs:1,sm:2,lg:3,className:"g-3 mb-5 g-xl-4 g-xxl-5",children:c.map((e=>Object(p.jsx)(F,{product:{...e},withdraw:l})))}):Object(p.jsx)("p",{className:"fs-5",children:"No products available"})]})})};var q=function(){const[e,t]=Object(n.useState)(!1),[c,a]=Object(n.useState)(!0),s=window.walletConnection.account(),[r,o]=Object(n.useState)("0"),d=Object(n.useCallback)((async()=>{s.accountId&&o(await async function(){return Object(j.formatNearAmount)((await window.walletConnection.account().getAccountBalance()).total,2)}())}));return Object(n.useEffect)((()=>{d()}),[d]),Object(p.jsx)(p.Fragment,{children:s.accountId?Object(p.jsxs)(i.a,{fluid:"md",children:[Object(p.jsxs)(l.a,{className:"justify-content-end align-items-center gap-4 pt-3 pb-5",children:[Object(p.jsx)(l.a.Item,{children:Object(p.jsx)("button",{onClick:()=>{t(!1),a(!0)},type:"button",className:"border px-3 py-1 rounded-pill btn btn-outline-dark",children:"Home"})}),Object(p.jsx)(l.a.Item,{children:Object(p.jsx)("button",{onClick:()=>{t(!0),a(!1)},type:"button",className:"border px-3 py-1 rounded-pill btn btn-outline-dark",children:"Profile"})}),Object(p.jsx)(l.a.Item,{children:Object(p.jsx)(g,{address:s.accountId,amount:r,symbol:"NEAR",destroy:h})})]}),Object(p.jsxs)("main",{children:[e&&Object(p.jsx)(K,{user:s.accountId}),c&&Object(p.jsx)(W,{})]})]}):Object(p.jsx)(L,{name:"Street Food",login:x,coverImg:J})})};var V=e=>{e&&e instanceof Function&&c.e(3).then(c.bind(null,464)).then((t=>{let{getCLS:c,getFID:n,getFCP:a,getLCP:s,getTTFB:r}=t;c(e),n(e),a(e),s(e),r(e)}))};c(448),c(445),c(446);window.nearInitPromise=async function(){const e=await Object(d.connect)(Object.assign({keyStore:new d.keyStores.BrowserLocalStorageKeyStore},b));window.walletConnection=new d.WalletConnection(e,"mycontract.ozo_vehe.testnet"),window.accountId=window.walletConnection.getAccountId(),window.walletConnection.account()&&(window.contract=new d.Contract(window.walletConnection.account(),o,{viewMethods:["getProduct","getProducts","getHighestBid","getHighestBidder"],changeMethods:["placeBid","setProduct","withdrawBid"]}))}().then((()=>{r.a.render(Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(q,{})}),document.getElementById("root"))})).catch(console.error),V()}},[[447,1,2]]]);
//# sourceMappingURL=main.46c962fe.chunk.js.map